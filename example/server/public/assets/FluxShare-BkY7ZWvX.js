import{_ as e,a as t,c as n,d as r,f as i,g as a,h as o,i as ee,l as s,m as c,n as l,o as u,p as d,r as f,s as p,t as m,u as h,v as g}from"./index-CKDDYGZ7.js";var _=[`disabled`],v=[`disabled`],y={id:`public-history`,style:{"background-color":`#f0f0f0`,border:`1px solid #ccc`,padding:`10px`,"min-height":`100px`}},b={key:0},x={key:0},S=[`href`],te={key:2},ne=[`disabled`],re={key:0,style:{"margin-left":`10px`}},ie={class:`room-log-container`},C={key:0,class:`log-placeholder`},w={class:`log-timestamp`},T={key:0},E={key:1},D={key:1},O=[`href`],k=m({__name:`FluxShare`,setup(m){let k=o({text:`Disconnected`,color:`red`}),A=a([]),j=a([]),M=a(null),N=a(`N/A`),P=a(``),F=a(null),I=a([]),L=o({roomId:``,capacity:2,mode:`singleton`}),R=a(``),z=a(``),B=a(null),V=a(null),H=null,U=`http://localhost:3000`,W=(e,t=`message`)=>({timestamp:new Date().toLocaleTimeString(),type:t,content:e}),G=e=>{j.value.push(W(e,`message`))},K=e=>{j.value.push(W(e,`data`))},q=e=>{e.some(e=>K(e))},J=e=>e.length<=50?e:`${e.substring(0,35)}...${e.substring(e.length-15)}`,Y=(e,t=2)=>{if(e===0)return`0 Bytes`;let n=1024,r=t<0?0:t,i=[`Bytes`,`KB`,`MB`,`GB`,`TB`],a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/n**+a).toFixed(r))+` `+i[a]},X=(e,t)=>`${U}/files/${e}?filename=${encodeURIComponent(t)}`,Z=()=>{if(!P.value.trim())return;let e={type:`string`,content:P.value};H.emit(`public:upload`,e),P.value=``},ae=e=>{I.value=Array.from(e.target.files)},oe=()=>{I.value.length!==0&&(I.value.forEach(e=>{let t={type:`file`,content:e,fileName:e.name,mimeType:e.type};H.emit(`public:upload`,t)}),F.value&&(F.value.value=``),I.value=[])},se=()=>{H.emit(`public:deleteLast`)},ce=e=>{V.value=e.target.files[0]||null},le=()=>{if(!L.roomId||!L.capacity)return alert(`Room ID and capacity are required.`);H.emit(`room:create`,{...L},e=>{G(`[Create Room] ${e.message}`),e.success&&(R.value=e.roomId,N.value=L.mode,Q())})},Q=()=>{let e=R.value;if(!e)return alert(`Please enter a Room ID to join.`);H.emit(`room:join`,e,t=>{G(`[Join Room] ${t.message}`),t.success&&(M.value=e,t.data&&(Array.isArray(t.data)?(G(`Received ${t.data.length} historical items.`),q(t.data)):(G(`Received initial singleton data.`),K(t.data))),N.value=L.mode)})},ue=()=>{M.value&&(G(`Requesting room history...`),H.emit(`room:history`,M.value,e=>{e.success&&e.data?(G(`History refreshed. Found ${e.data.length} items.`),q(e.data)):G(`[ERROR] ${e.message}`)}))},de=()=>{if(!M.value)return alert(`You must join a room before sending data!`);let e=null;if(V.value){let t=V.value;e={type:`file`,content:t,fileName:t.name,mimeType:t.type}}else z.value&&(e={type:`string`,content:z.value});if(!e)return alert(`No data to send.`);H.emit(`room:upload`,{roomId:M.value,data:e},t=>{t.success?e.type===`string`?z.value=``:e.type===`file`&&(V.value=null,B.value&&(B.value.value=``)):(G(`[ERROR] ${t.message}`),alert(`Failed to send data: ${t.message}`))})};h(()=>{H=io(U,{auth:{token:`valid-token-for-testing`}}),H.on(`connect`,()=>{k.text=`Connected`,k.color=`green`}),H.on(`disconnect`,()=>{k.text=`Disconnected`,k.color=`red`,M.value=null,N.value=`N/A`}),H.on(`public:history`,e=>{A.value=e}),H.on(`room:data`,e=>{K(e)})}),r(()=>{H&&H.disconnect()});function $(e){let t=e.target;return new Promise((e,n)=>{if(!t)return n(Error(`元素不存在。`));let r=t.textContent||t.innerText;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(r).then(()=>{e()}).catch(e=>{console.error(`使用 navigator.clipboard.writeText 复制失败:`,e),n(Error(`复制失败：请确保您的浏览器允许访问剪贴板。`))});else{let t;try{t=document.createElement(`textarea`),t.value=r,t.style.position=`fixed`,t.style.opacity=`0`,document.body.appendChild(t),t.select(),document.execCommand(`copy`),document.body.removeChild(t),e()}catch(e){console.error(`使用 document.execCommand 复制失败:`,e),t&&t.parentNode&&document.body.removeChild(t),n(Error(`复制失败：您的浏览器不支持剪贴板API，且 execCommand 回退也失败。`))}}})}return(r,a)=>(i(),n(`div`,null,[a[27]||=u(`h1`,null,`Flux-Share Client Tester`,-1),u(`p`,null,[a[6]||=u(`b`,null,`Connection Status:`,-1),u(`span`,{style:e({color:k.color})},g(k.text),5)]),a[28]||=u(`hr`,null,null,-1),u(`fieldset`,null,[a[8]||=u(`legend`,null,[u(`h2`,null,`Public Board`)],-1),u(`div`,null,[c(u(`input`,{type:`text`,"onUpdate:modelValue":a[0]||=e=>P.value=e,placeholder:`Enter text to share`,onKeyup:ee(Z,[`enter`]),style:{width:`300px`}},null,544),[[f,P.value]]),u(`button`,{onClick:Z,disabled:!P.value},`Send Text`,8,_)]),a[9]||=u(`br`,null,null,-1),u(`div`,null,[u(`input`,{type:`file`,ref_key:`publicFileInput`,ref:F,onChange:ae,multiple:``},null,544),u(`button`,{onClick:oe,disabled:I.value.length===0},`Upload Files`,8,v)]),a[10]||=u(`br`,null,null,-1),u(`div`,null,[u(`button`,{onClick:se},`Delete Last from Public`)]),a[11]||=u(`br`,null,null,-1),u(`div`,null,[a[7]||=u(`h3`,null,`Current Public History:`,-1),u(`div`,y,[A.value.length===0?(i(),n(`div`,b,`Waiting for data...`)):p(``,!0),(i(!0),n(t,null,d(A.value,(e,t)=>(i(),n(`div`,{key:t},[e.type===`file`?(i(),n(`div`,x,[u(`a`,{href:X(e.fileId,e.fileName),target:`_blank`},` 📄 文件: `+g(J(e.fileName))+` (`+g(Y(e.size))+`) `,9,S)])):e.type===`string`?(i(),n(`p`,{key:1,style:{margin:`5px 0`},onClick:$},g(e.content),1)):(i(),n(`p`,te,g(e),1))]))),128))])])]),a[29]||=u(`hr`,null,null,-1),u(`fieldset`,null,[a[23]||=u(`legend`,null,[u(`h2`,null,`Private Rooms`)],-1),u(`fieldset`,null,[a[13]||=u(`legend`,null,[u(`h3`,null,`Step 1: Create a Room`)],-1),c(u(`input`,{type:`text`,"onUpdate:modelValue":a[1]||=e=>L.roomId=e,placeholder:`Room ID`},null,512),[[f,L.roomId]]),c(u(`input`,{type:`number`,"onUpdate:modelValue":a[2]||=e=>L.capacity=e,placeholder:`Capacity`},null,512),[[f,L.capacity,void 0,{number:!0}]]),c(u(`select`,{"onUpdate:modelValue":a[3]||=e=>L.mode=e},[...a[12]||=[u(`option`,{value:`singleton`},`Singleton Mode`,-1),u(`option`,{value:`live`},`Live Mode`,-1),u(`option`,{value:`history`},`History Mode`,-1)]],512),[[l,L.mode]]),u(`button`,{onClick:le},`Create Room`)]),a[24]||=u(`br`,null,null,-1),u(`fieldset`,null,[a[16]||=u(`legend`,null,[u(`h3`,null,`Step 2: Join a Room`)],-1),c(u(`input`,{type:`text`,"onUpdate:modelValue":a[4]||=e=>R.value=e,placeholder:`Room ID`},null,512),[[f,R.value]]),u(`button`,{onClick:Q},`Join Room`),u(`p`,null,[a[14]||=u(`b`,null,`Currently in room:`,-1),a[15]||=s(),u(`span`,null,g(M.value||`None`)+` (`+g(N.value)+`)`,1)])]),a[25]||=u(`br`,null,null,-1),u(`fieldset`,null,[a[17]||=u(`legend`,null,[u(`h3`,null,`Step 3: Send Data to Room`)],-1),c(u(`input`,{type:`text`,"onUpdate:modelValue":a[5]||=e=>z.value=e,placeholder:`Enter text to send`},null,512),[[f,z.value]]),a[18]||=u(`br`,null,null,-1),a[19]||=u(`br`,null,null,-1),u(`input`,{type:`file`,ref_key:`roomFileInput`,ref:B,onChange:ce},null,544),a[20]||=u(`br`,null,null,-1),a[21]||=u(`br`,null,null,-1),u(`button`,{onClick:de,disabled:!z.value&&!V.value},`Send to Room`,8,ne),V.value?(i(),n(`span`,re,`Selected: `+g(V.value.name),1)):p(``,!0)]),a[26]||=u(`br`,null,null,-1),u(`div`,null,[u(`h3`,null,[a[22]||=s(` Room Logs & Received Data `,-1),N.value===`history`?(i(),n(`button`,{key:0,onClick:ue,style:{"margin-left":`20px`,"font-size":`0.8em`}},` Refresh History `)):p(``,!0)]),u(`div`,ie,[j.value.length===0?(i(),n(`div`,C,`...`)):p(``,!0),(i(!0),n(t,null,d(j.value,(e,t)=>(i(),n(`div`,{key:t,class:`log-entry`},[u(`span`,w,`[`+g(e.timestamp)+`]`,1),e.type===`message`?(i(),n(`span`,T,g(e.content),1)):e.type===`data`?(i(),n(`span`,E,[e.content.type===`string`?(i(),n(`span`,{key:0,onClick:$},g(e.content.content),1)):e.content.type===`file`?(i(),n(`span`,D,[u(`a`,{href:X(e.content.fileId,e.content.fileName),target:`_blank`},` 📄 `+g(J(e.content.fileName))+` (`+g(Y(e.content.size))+`) `,9,O)])):p(``,!0)])):p(``,!0)]))),128))])])])]))}},[[`__scopeId`,`data-v-2684cf5f`]]);export{k as default};